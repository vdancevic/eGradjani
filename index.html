<!DOCTYPE html>
<html>
    <meta charset="utf-8">
    <style>
  path:hover {
	fill-opacity: .7;
}



#tooltip {   
	  position: absolute;            
		text-align: center;
		padding: 20px;             
		margin: 10px;
		font: 12px sans-serif;        
		background: lightsteelblue;   
		border: 1px;      
		border-radius: 2px;           
		pointer-events: none;         
	}
	#tooltip h4{
    text-align: center;
		margin:0;
		font-size:14px;
	}
	#tooltip{
		background:rgba(0,0,0,0.9);
		border:1px solid grey;
		border-radius:5px;
		font-size:12px;
		width:auto;
		padding:4px;
		color:black;
		opacity:0;
	}
	#tooltip table{
		table-layout:fixed;
	}
	#tooltip tr td{
		padding:0;
		margin:0;
	}
	#tooltip tr td:nth-child(1){
		width:100px;
	}
	#tooltip tr td:nth-child(2){
		text-align:center;
	}
    </style>

    <head>
     <script src="http://d3js.org/d3.v3.min.js"></script>
     <script src="http://d3js.org/topojson.v1.min.js"></script>
     <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    </head>


    <body>
     
	    
    <script>

    var width = 960;
    var height = 700;
    active = d3.select(null);

    var projection = d3.geo.mercator()
                           .center([0, 10])
                           .scale(6000)
                           .translate([17600, 4500])
                           .rotate([-180, 0]);

    var path = d3.geo.path()
                     .projection(projection);

    var svg = d3.select("body")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .style("background", "lightsteelblue")
                .on("click", stopped, true);
    
    var g = svg.append("g");

    var zoom = d3.behavior.zoom()
    .translate([0, 0])
    .scale(1)
    .scaleExtent([1, 8])
    .on("zoom", zoomed);

    var tooltip = d3.select("body")
                    .append("div")
                    .style("position", "absolute")
                    .style("background","#37DC00")
                    .style("visibility", "hidden");

    svg.call(zoom.event);
      
    var a = d3.json("cro_regv31.json", function(error, cro)
    {
        var data = topojson.feature(cro, cro.objects.layer1);
        var data1 = topojson.feature(cro, cro.objects.layer1.geometries);
        var states = g.selectAll("path.county")
                        .data(data.features)
                        .enter()
                        .append("path")
                        .attr("class", "county")
                        .attr("id", function(d) { return d.id; })
                        .attr("d", path) 
                        .style("fill", "red")
                        .style("stroke", "gray")
                        .style("stroke-width", 1)
                        .style("stroke-opacity", 1)
                        .on('click', clicked)             

 });
 function clicked(d) 
 {
  d3.select("div").transition()
                .duration(750)
                .style("opacity", 1);

  tooltip.style("visibility", "visible")
  
  d3.select("div").html(function() 
                      {
                      return "<h4>"+d.properties.name+"</h4><table>"+
                             "<tr><td>Sjedište:</td><td>"+(d.properties.Sjediste)+"</td></tr>"+          
			                 "<tr><td>Površina:</td><td>"+(d.properties.Povrsina_km2)+"</td><td>km2</td></tr>"+
			                 "<tr><td>Broj stanovnika:</td><td>"+(d.properties.Br_stanovnika_2011)+"</td></tr>"+
			                 "<tr><td>Broj općina:</td><td>"+(d.properties.Br_opcina)+"</td></tr>"+
                             "<tr><td>Broj gradova:</td><td>"+(d.properties.Br_gradova)+"</td></tr>"+
			                 "</table>";
                      })
                        tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
                     
  var bounds = path.bounds(d),
      dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2,
      scale = Math.max(1, Math.min(8, 0.85 / Math.max(dx / width, dy / height))),
      translate = [width / 2 - scale * x, height / 2 - scale * y];
  
     g.transition()
                .duration(750)
                .attr("transform", "translate(" + translate + ")scale(" + scale + ")");

     g.transition()
                .duration(750)
                .delay(10000)
                .attr("transform", "")
                
                
    d3.select("div").transition()
                .duration(750)
                .delay(10000)   
                .style("visibility", "hidden")
                .style("opacity", 0);          
               
}

function zoomed() {
  g.style("stroke-width", 1.5 / d3.event.scale + "px");
  g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
}

function stopped() {
  if (d3.event.defaultPrevented) d3.event.stopPropagation();
}

    </script>
	    
    </body>
</html>

